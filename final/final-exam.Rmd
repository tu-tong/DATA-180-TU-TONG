---
title: "Final exam"
subtitle: "Data 180, Professor Kennedy"
author: 
  name: "Tu Tong"
  email: "tongtu@dickinson.edu"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output: 
  html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
#read csv file
dataset <- "/Users/tu/Desktop/DATA180-Tu/final/loan_default_data_set.csv"
loan_df <- read.csv(dataset) 
loan_df
#load libraries
library(tidyverse)
library(dplyr)
library(DescTools)
library(ggplot2)
```

## 1.Data Wrangling

a) The dimension: 20000x21
- The data set has 20000 rows and 21 columns

b) Column names are:"tot_balance", "avg_bal_cards", "credit_age", "credit_age_good_account" , "credit_card_age", "num_acc_30d_past_due_12_months", "num_acc_30d_past_due_6_months", "num_mortgage_currently_past_due", "tot_amount_currently_past_due", "num_inq_12_month", "num_card_inq_24_month", "num_card_12_month",   "num_auto_.36_month", "uti_open_card", "pct_over_50_uti", "uti_max_credit_line", "pct_card_over_50_uti", "ind_XYZ", "rep_income", "rep_education", "Def_ind"

c) Types of data in the data set: numeric, integer, and character.

```{r}
dim(loan_df)
columns <- colnames(loan_df)
lapply(loan_df, class)
```

d) Columns that have missing values: rep_income, pct_card_over_50_uti
rep_income is missing 7.795% values.
pct_card_over_50_uti is missing 9.790% values.
```{r}
numNa <- colSums(is.na(loan_df))
colNa <- subset(numNa, numNa > 0)
colNa
naStat <- (colNa/nrow(loan_df))*100
naStat
```

e) We can deal with missing values by removing the rows or columns that contain the missing values or substituting missing values with other values (such as sample mean). However, there is no best way to approach.

f) With this data, I would fit a supervised learning model because there is one response variable to 20 predictor variables in the data set. The supervised model would fit the goal to use all applicants' information (predictor variables) to make prediction on whether this applicant should be lent money or not (response variable).

g) Drop all rows with missing values, print dim()
Dimension of new data set is 16653 x 21 (16653 rows, 21 columns)
```{r}
new_loan_df <- drop_na(loan_df)
new_loan_df
dim(new_loan_df)
```

## 2. Data summary statistics

a)
```{r}
summary(new_loan_df)
#summary(new_loan_df$num_card_inq_24_month)
#summary(new_loan_df$tot_amount_currently_past_due)
```

b) "num_card_inq_24_month" and "tot_amount_currently_past_due" are both right-skewed because mean > median.
"credit_age" is bell-shaped because the median is approximately equal to the mean.

c) The shapes confirm my answer above.
```{r}
ggplot(new_loan_df, aes(x=num_card_inq_24_month)) +
  geom_histogram(fill = "darkcyan")
ggplot(new_loan_df, aes(x=tot_amount_currently_past_due)) +
  geom_histogram(fill = "darkslategrey")
ggplot(new_loan_df, aes(x=credit_age)) +
  geom_histogram(fill = "chocolate3")
```

d) Two ways to convert "rep_education" (categorical) to numerical data:
- Convert each category to a specific number. For example, 'high_school' to 0, 'college' to 1, and 'graduate' to 2.
- Convert by using the matrix of 0 and 1 (binary). Count the existence of each category, so each category is now displayed as a row. For instance, the value of that row will be 1 if the categorical value matches with the row and 0 if they are not matched.

## Data Visualization

a) Bar plot for 'Def_ind'
The graph has 2 values 0 (indicating not defaulted account) and 1 (defaulted account) on the x-axis, the y-axis shows the frequency of each x-value appear in the data set. There are more undefaulted account than defaulted one.
```{r}
ggplot(new_loan_df, aes(factor(x=Def_ind)))+
  geom_bar(fill = "darkolivegreen4")+
  xlab("Indicator of Default")+
  ylab("Number of accounts")+
  labs(caption = "0 = not defaulted, 1 = account defaulted", title = "Number of accounts based on the indicator of default")
  
```

b) Bar plot for 'rep_education'
Describe the graph: The x-axis shows the levels of education, and the y-axis shows number of applicants of each level accordingly. Applicants who is in college have the highest population among all.
```{r}
ggplot(new_loan_df, aes(x=rep_education))+
  geom_bar(fill = "chocolate1")+
  xlab("Levels of education")+
  ylab("Number of applicants")+
  labs(title="Number of applicants of each education level")
```

c) Histogram for 'rep_income'

```{r}
ggplot(new_loan_df, aes(x=rep_income))+
  geom_histogram(fill = "darksalmon")+
  xlab("Income range")+
  ylab("Number of applicants")+
  labs(title = "Distribution of income of applicants")+
  scale_x_continuous(labels = scales::comma)
```

d) Boxplot for 'tot_balance'
Summary:
-Min: 0
-1st Quarter: 92142
-Median: 107740
-Mean: 107503
-3rd Quarter: 122932
-Max: 200000

There are outliers in the data set, as printed out in the console.

```{r}
ggplot(new_loan_df, aes(x=tot_balance))+
  geom_boxplot()+
  xlab("Total available balance")+
  labs(title = "Distribution of total available balance for all credit products")

#summary
summary(new_loan_df$tot_balance) 

#find outliers
outliers <- boxplot.stats(new_loan_df$tot_balance)$out
print(outliers)

```
Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
